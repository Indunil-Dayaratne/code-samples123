resource "azurerm_virtual_machine_extension" "app-am" {
  count                      = "${var.install_anti_malware == "true" ? 1 : 0}"
  name                       = "AntiMalware"
  location                   = "${var.resource_group_location}"
  resource_group_name        = "${var.resource_group_name}"
  virtual_machine_name       = "${var.resource_prefix}-vm-${var.short_region}-${var.environment}"
  depends_on                 = ["azurerm_virtual_machine.azurevm"]
  publisher                  = "Microsoft.Azure.Security"
  type                       = "IaaSAntimalware"
  type_handler_version       = "1.3"
  auto_upgrade_minor_version = "true"

    settings = <<SETTINGS
        {
            "AntimalwareEnabled": true,
            "RealtimeProtectionEnabled": "true",
            "ScheduledScanSettings": {
                "isEnabled": "true",
                "day": "1",
                "time": "120",
                "scanType": "Quick"
            },
            "Exclusions" : {
                "Extensions": "",
                "Paths": "",
                "Processes": ""
            }
        }
    SETTINGS
}